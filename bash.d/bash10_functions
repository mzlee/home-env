# .bash_functions
function choice {
    file="$1"
    lc=`wc -l < $file`

    if [ "$lc" -gt 0 ]
    then
	line=`expr 1 + $RANDOM % $lc`
	head -n $line $file | tail -n 1
    fi
}

function find_pub_machine {
    local COUNT=0
    if [ -f $HOME/.public_machines ]
    then
	if [ -n "$LAST_PUBLIC" ]
	then
	    local ulist=`ssh $LAST_PUBLIC "users"`;
	    for u in $ulist
	    do
		if [ $u != mzlee ]
		then
		    export LAST_PUBLIC=""
		fi
	    done
	fi
	while [ $COUNT -lt 5 -a -z "$LAST_PUBLIC" ]
	do
	    local mach=`choice $HOME/.public_machines`
	    local ulist=`ssh $mach "users"`
	    echo "$mach => $ulist"
	    if [ -z "$ulist" ]
	    then
		export LAST_PUBLIC=$mach
	    fi
	    local COUNT=`expr $COUNT + 1`
	done
    fi
}

function pub_connect {
    while [ -z "$LAST_PUBLIC" ]
    do
	find_pub_machine
    done
    ssh $USERNAME@$LAST_PUBLIC $@
}
